(globalThis.TURBOPACK = globalThis.TURBOPACK || []).push([typeof document === "object" ? document.currentScript : undefined, {

"[project]/src/app/data:4317fa [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"7efa29b2bf7fa82364aadbf5011c649e7f21f09fbf":"createAgent"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "createAgent": (()=>createAgent)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var createAgent = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("7efa29b2bf7fa82364aadbf5011c649e7f21f09fbf", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "createAgent"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoidVJBNlJzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:63a50e [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"40d5d08abcb55310482395efa2b68b3d883c709e39":"getChatsByCompany"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "getChatsByCompany": (()=>getChatsByCompany)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var getChatsByCompany = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("40d5d08abcb55310482395efa2b68b3d883c709e39", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "getChatsByCompany"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiNlJBb2lCc0IifQ==
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:d7b86b [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"40534236dcc36f51af1a921f1d5dd985231fa0be2f":"getMessagesForChat"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "getMessagesForChat": (()=>getMessagesForChat)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var getMessagesForChat = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("40534236dcc36f51af1a921f1d5dd985231fa0be2f", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "getMessagesForChat"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOFJBK2tCc0IifQ==
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:32909b [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"70550f3a06ff63d8c1c6555f235fca6dc7330a34c0":"sendMessage"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "sendMessage": (()=>sendMessage)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var sendMessage = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("70550f3a06ff63d8c1c6555f235fca6dc7330a34c0", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "sendMessage"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoidVJBdW5Cc0IifQ==
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:b9928e [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"609d4f76fb496a216c91066f2d4684c160f7fd02a4":"setChatbotStatus"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "setChatbotStatus": (()=>setChatbotStatus)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var setChatbotStatus = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("609d4f76fb496a216c91066f2d4684c160f7fd02a4", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "setChatbotStatus"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiNFJBeXBCc0IifQ==
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:11ee9a [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"78e1313773a3e1763f3457daecfd448d9fb5a79106":"startNewChats"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "startNewChats": (()=>startNewChats)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var startNewChats = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("78e1313773a3e1763f3457daecfd448d9fb5a79106", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "startNewChats"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoieVJBdXFCc0IifQ==
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:1af868 [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"40ddb22e27e4cef48e6f8b4f4548db5d5d7b59d98c":"getContactsByCompany"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "getContactsByCompany": (()=>getContactsByCompany)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var getContactsByCompany = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("40ddb22e27e4cef48e6f8b4f4548db5d5d7b59d98c", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "getContactsByCompany"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiZ1NBMGFzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:17822f [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"4087786a1113f54129434f2a7816d4f589ebf1b846":"getAgentsByCompany"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "getAgentsByCompany": (()=>getAgentsByCompany)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var getAgentsByCompany = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("4087786a1113f54129434f2a7816d4f589ebf1b846", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "getAgentsByCompany"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOFJBNERzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:376e6d [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"60baf496c3062efe4fd326c7af2943c2196e029cce":"assignAgentToContact"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "assignAgentToContact": (()=>assignAgentToContact)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var assignAgentToContact = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("60baf496c3062efe4fd326c7af2943c2196e029cce", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "assignAgentToContact"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiZ1NBNmVzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:227061 [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"780997e968e3cabe30367154f3b8d33efe060f51bd":"addNoteToContact"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "addNoteToContact": (()=>addNoteToContact)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var addNoteToContact = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("780997e968e3cabe30367154f3b8d33efe060f51bd", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "addNoteToContact"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiNFJBMmZzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:680dff [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"783b92989339fb5b73f8cf537b1cd9811ad31c6bdf":"createContact"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "createContact": (()=>createContact)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var createContact = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("783b92989339fb5b73f8cf537b1cd9811ad31c6bdf", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "createContact"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoieVJBa2NzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:a65a13 [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"40ff6278859af3f524ec2ac84e79db5390255a1668":"createAnnouncement"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "createAnnouncement": (()=>createAnnouncement)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var createAnnouncement = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("40ff6278859af3f524ec2ac84e79db5390255a1668", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "createAnnouncement"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOFJBZ0ZzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:76483a [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"409b841e613ce80e5c40df0364f6df47d80421d363":"getAnnouncementsByCompany"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "getAnnouncementsByCompany": (()=>getAnnouncementsByCompany)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var getAnnouncementsByCompany = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("409b841e613ce80e5c40df0364f6df47d80421d363", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "getAnnouncementsByCompany"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoicVNBOEhzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:e21d65 [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"60daecd654edd9aad0f66818f3643edb5b83926f6b":"markAnnouncementAsRead"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "markAnnouncementAsRead": (()=>markAnnouncementAsRead)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var markAnnouncementAsRead = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("60daecd654edd9aad0f66818f3643edb5b83926f6b", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "markAnnouncementAsRead"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoia1NBcUpzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:1be7c2 [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"70fcfed8bffc4caf060f93474e4a8996b303b4b0fc":"addCommentToAnnouncement"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "addCommentToAnnouncement": (()=>addCommentToAnnouncement)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var addCommentToAnnouncement = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("70fcfed8bffc4caf060f93474e4a8996b303b4b0fc", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "addCommentToAnnouncement"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoib1NBbUtzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:8df2a1 [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"404d8f1b9c2cd44e439a3f4dba37f710171ff8f88b":"getActivityLogs"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "getActivityLogs": (()=>getActivityLogs)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var getActivityLogs = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("404d8f1b9c2cd44e439a3f4dba37f710171ff8f88b", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "getActivityLogs"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiMlJBcVpzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:ba6c97 [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"6049a27b16f34690f84c6af4f9a048cb3293c23e61":"handleLogin"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "handleLogin": (()=>handleLogin)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var handleLogin = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("6049a27b16f34690f84c6af4f9a048cb3293c23e61", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "handleLogin"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoidVJBbVFzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/data:a4abea [app-client] (ecmascript) <text/javascript>": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
/* __next_internal_action_entry_do_not_use__ [{"70780065eead8858964f97f44aaa44c48f608e84ba":"handleSignUp"},"src/app/actions.ts",""] */ __turbopack_context__.s({
    "handleSignUp": (()=>handleSignUp)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/build/webpack/loaders/next-flight-loader/action-client-wrapper.js [app-client] (ecmascript)");
"use turbopack no side effects";
;
var handleSignUp = /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["createServerReference"])("70780065eead8858964f97f44aaa44c48f608e84ba", __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["callServer"], void 0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$build$2f$webpack$2f$loaders$2f$next$2d$flight$2d$loader$2f$action$2d$client$2d$wrapper$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["findSourceMapURL"], "handleSignUp"); //# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4vYWN0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJcblxuJ3VzZSBzZXJ2ZXInO1xuXG5pbXBvcnQgeyBnZXREYiB9IGZyb20gXCJAL2xpYi9kYlwiO1xuaW1wb3J0IHsgaGFzaFBhc3N3b3JkLCB2ZXJpZnlQYXNzd29yZCB9IGZyb20gXCJAL2xpYi9hdXRoXCI7XG5pbXBvcnQgdHlwZSB7IEFnZW50LCBBZ2VudFJvbGUsIEFubm91bmNlbWVudCwgQ29tcGFueSwgQ29tbWVudCwgQWN0aXZpdHlMb2csIFVzZXIsIE5vdGUsIENoYXQsIE1lc3NhZ2UsIENoYW5uZWwgfSBmcm9tIFwiQC90eXBlc1wiO1xuaW1wb3J0IHsgQ29sbGVjdGlvbiwgRGIsIE9iamVjdElkIH0gZnJvbSBcIm1vbmdvZGJcIjtcblxuYXN5bmMgZnVuY3Rpb24gZ2V0QWdlbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QWdlbnQ+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxBZ2VudD4oJ2FnZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb21wYW5pZXNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDb21wYW55Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q29tcGFueT4oJ2NvbXBhbmllcycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248QW5ub3VuY2VtZW50Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248QW5ub3VuY2VtZW50PignYW5ub3VuY2VtZW50cycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxBY3Rpdml0eUxvZz4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPEFjdGl2aXR5TG9nPignYWN0aXZpdHlfbG9ncycpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTogUHJvbWlzZTxDb2xsZWN0aW9uPFVzZXI+PiB7XG4gICAgY29uc3QgZGI6IERiID0gYXdhaXQgZ2V0RGIoKTtcbiAgICByZXR1cm4gZGIuY29sbGVjdGlvbjxVc2VyPignY29udGFjdHMnKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Q2hhdHNDb2xsZWN0aW9uKCk6IFByb21pc2U8Q29sbGVjdGlvbjxDaGF0Pj4ge1xuICAgIGNvbnN0IGRiOiBEYiA9IGF3YWl0IGdldERiKCk7XG4gICAgcmV0dXJuIGRiLmNvbGxlY3Rpb248Q2hhdD4oJ2NoYXRzJyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpOiBQcm9taXNlPENvbGxlY3Rpb248TWVzc2FnZT4+IHtcbiAgICBjb25zdCBkYjogRGIgPSBhd2FpdCBnZXREYigpO1xuICAgIHJldHVybiBkYi5jb2xsZWN0aW9uPE1lc3NhZ2U+KCdtZXNzYWdlcycpO1xufVxuXG5cbmFzeW5jIGZ1bmN0aW9uIGxvZ0FjdGl2aXR5KGNvbXBhbnlJZDogc3RyaW5nIHwgT2JqZWN0SWQsIGFnZW50TmFtZTogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGV0YWlsczogc3RyaW5nKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGF3YWl0IGxvZ3NDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgYWdlbnROYW1lLFxuICAgICAgICAgICAgYWN0aW9uLFxuICAgICAgICAgICAgZGV0YWlscyxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBsb2cgYWN0aXZpdHk6XCIsIGVycm9yKTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBZ2VudHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFnZW50W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnRzID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9LCB7IHByb2plY3Rpb246IHsgcGFzc3dvcmQ6IDAgfSB9KS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGFnZW50cy5tYXAoYWdlbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFnZW50LFxuICAgICAgICAgICAgX2lkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGlkOiBhZ2VudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYWdlbnQuY29tcGFueUlkPy50b1N0cmluZygpLFxuICAgICAgICB9KSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFnZW50cyBieSBjb21wYW55OlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVBbm5vdW5jZW1lbnQoZGF0YTogeyB0aXRsZTogc3RyaW5nOyBjb250ZW50OiBzdHJpbmc7IGNhdGVnb3J5OiBzdHJpbmc7IGF1dGhvcklkOiBzdHJpbmc7IGNvbXBhbnlJZDogc3RyaW5nIH0pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgYW5ub3VuY2VtZW50PzogQW5ub3VuY2VtZW50IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG5cbiAgICAgICAgY29uc3QgYXV0aG9yID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgX2lkOiBuZXcgT2JqZWN0SWQoZGF0YS5hdXRob3JJZCkgfSk7XG4gICAgICAgIGlmICghYXV0aG9yKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRob3Igbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdBbm5vdW5jZW1lbnQ6IE9taXQ8QW5ub3VuY2VtZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdGl0bGU6IGRhdGEudGl0bGUsXG4gICAgICAgICAgICBjb250ZW50OiBkYXRhLmNvbnRlbnQsXG4gICAgICAgICAgICBjYXRlZ29yeTogZGF0YS5jYXRlZ29yeSBhcyBhbnksXG4gICAgICAgICAgICBhdXRob3I6IHtcbiAgICAgICAgICAgICAgICBpZDogYXV0aG9yLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF1dGhvci5uYW1lLFxuICAgICAgICAgICAgICAgIGF2YXRhcjogYXV0aG9yLmF2YXRhclxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGRhdGEuY29tcGFueUlkKSxcbiAgICAgICAgICAgIGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICAgIHJlYWRCeTogW10sXG4gICAgICAgICAgICBjb21tZW50czogW10sXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24uaW5zZXJ0T25lKG5ld0Fubm91bmNlbWVudCBhcyBhbnkpO1xuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShkYXRhLmNvbXBhbnlJZCwgYXV0aG9yLm5hbWUsICdDcmVhdGUgQW5ub3VuY2VtZW50JywgYFB1Ymxpc2hlZDogXCIke2RhdGEudGl0bGV9XCJgKTtcblxuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgY3JlYXRlZEFubm91bmNlbWVudDogQW5ub3VuY2VtZW50ID0ge1xuICAgICAgICAgICAgICAgIC4uLihuZXdBbm5vdW5jZW1lbnQgYXMgQW5ub3VuY2VtZW50KSxcbiAgICAgICAgICAgICAgICBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkLFxuICAgICAgICAgICAgICAgIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogZGF0YS5jb21wYW55SWQsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYW5ub3VuY2VtZW50OiBjcmVhdGVkQW5ub3VuY2VtZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gY3JlYXRlIGFubm91bmNlbWVudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYW5ub3VuY2VtZW50IGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbm5vdW5jZW1lbnRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxBbm5vdW5jZW1lbnRbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFubm91bmNlbWVudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGFubm91bmNlbWVudHMgPSBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgZGF0ZTogLTEgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBhbm5vdW5jZW1lbnRzLm1hcChhbm5vdW5jZW1lbnQgPT4gKHtcbiAgICAgICAgICAgIC4uLmFubm91bmNlbWVudCxcbiAgICAgICAgICAgIF9pZDogYW5ub3VuY2VtZW50Ll9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFubm91bmNlbWVudC5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogYW5ub3VuY2VtZW50LmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgcmVhZEJ5OiBhbm5vdW5jZW1lbnQucmVhZEJ5IHx8IFtdLFxuICAgICAgICAgICAgY29tbWVudHM6IGFubm91bmNlbWVudC5jb21tZW50cyB8fCBbXSxcbiAgICAgICAgfSkpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGFubm91bmNlbWVudHMgYnkgY29tcGFueTpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbWFya0Fubm91bmNlbWVudEFzUmVhZChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkYWRkVG9TZXQ6IHsgcmVhZEJ5OiBhZ2VudElkIH0gfVxuICAgICAgICApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIk1hcmsgYXMgcmVhZCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGFkZENvbW1lbnRUb0Fubm91bmNlbWVudChhbm5vdW5jZW1lbnRJZDogc3RyaW5nLCBhdXRob3JJZDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbiwgY29tbWVudD86IENvbW1lbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGF1dGhvciA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGF1dGhvcklkKSB9KTtcbiAgICAgICAgaWYgKCFhdXRob3IpIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlIH07XG5cbiAgICAgICAgY29uc3QgbmV3Q29tbWVudDogQ29tbWVudCA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICAgICAgaWQ6IGF1dGhvci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdXRob3IubmFtZSxcbiAgICAgICAgICAgICAgICBhdmF0YXI6IGF1dGhvci5hdmF0YXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50LFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgYW5ub3VuY2VtZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBbm5vdW5jZW1lbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBhd2FpdCBhbm5vdW5jZW1lbnRzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGFubm91bmNlbWVudElkKSB9LFxuICAgICAgICAgICAgeyAkcHVzaDogeyBjb21tZW50czogbmV3Q29tbWVudCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIGNvbW1lbnQ6IG5ld0NvbW1lbnQgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgY29tbWVudCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQcm9maWxlKGFnZW50SWQ6IHN0cmluZywgbmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwaG9uZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZVJlc3VsdCA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24udXBkYXRlT25lKFxuICAgICAgICAgICAgeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IG5hbWUsIGVtYWlsLCBwaG9uZSB9IH1cbiAgICAgICAgKTtcblxuICAgICAgICBpZiAodXBkYXRlUmVzdWx0Lm1vZGlmaWVkQ291bnQgPT09IDAgJiYgdXBkYXRlUmVzdWx0Lm1hdGNoZWRDb3VudCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRBZ2VudERvYyA9IGF3YWl0IGFnZW50c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGFnZW50SWQpIH0pO1xuXG4gICAgICAgIGlmICh1cGRhdGVkQWdlbnREb2MpIHtcbiAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gdXBkYXRlZEFnZW50RG9jO1xuICAgICAgICAgICAgY29uc3QgdXBkYXRlZEFnZW50OiBBZ2VudCA9IHtcbiAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgX2lkOiB1cGRhdGVkQWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgaWQ6IHVwZGF0ZWRBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IHVwZGF0ZWRBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgYXdhaXQgbG9nQWN0aXZpdHkoY29tcGFueUlkLCB1cGRhdGVkQWdlbnQubmFtZSwgJ1VwZGF0ZSBQcm9maWxlJywgYFVwZGF0ZWQgcHJvZmlsZSBkZXRhaWxzYCk7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogdXBkYXRlZEFnZW50IH07XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJGYWlsZWQgdG8gcmV0cmlldmUgdXBkYXRlZCBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYWdlbnQgcHJvZmlsZSBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLlwiIH07XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWdlbnRQYXNzd29yZChhZ2VudElkOiBzdHJpbmcsIGN1cnJlbnRQYXNzd29yZF91bnVzZWQ6IHN0cmluZywgbmV3UGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U6IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYWdlbnRzQ29sbGVjdGlvbiA9IGF3YWl0IGdldEFnZW50c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgYWdlbnQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IG5ldyBPYmplY3RJZChhZ2VudElkKSB9KTtcblxuICAgICAgICBpZiAoIWFnZW50IHx8ICFhZ2VudC5wYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQWdlbnQgbm90IGZvdW5kLlwiIH07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKGN1cnJlbnRQYXNzd29yZF91bnVzZWQsIGFnZW50LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFpc1Bhc3N3b3JkVmFsaWQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkluY29ycmVjdCBjdXJyZW50IHBhc3N3b3JkLlwiIH07XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBuZXdIYXNoZWRQYXNzd29yZCA9IGF3YWl0IGhhc2hQYXNzd29yZChuZXdQYXNzd29yZF91bnVzZWQpO1xuICAgICAgICBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoYWdlbnRJZCkgfSxcbiAgICAgICAgICAgIHsgJHNldDogeyBwYXNzd29yZDogbmV3SGFzaGVkUGFzc3dvcmQgfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGFnZW50Lm5hbWUsICdVcGRhdGUgUGFzc3dvcmQnLCBgQ2hhbmdlZCBwYXNzd29yZGApO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBtZXNzYWdlOiBcIlBhc3N3b3JkIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVXBkYXRlIHBhc3N3b3JkIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIHVuZXhwZWN0ZWQgZXJyb3Igb2NjdXJyZWQuXCIgfTtcbiAgICB9XG59XG5cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZUxvZ2luKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkX3VudXNlZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgY29uc3QgYWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSB9KTtcblxuICAgICAgaWYgKGFnZW50RG9jICYmIGFnZW50RG9jLnBhc3N3b3JkKSB7XG4gICAgICAgIGNvbnN0IGlzUGFzc3dvcmRWYWxpZCA9IGF3YWl0IHZlcmlmeVBhc3N3b3JkKHBhc3N3b3JkX3VudXNlZCwgYWdlbnREb2MucGFzc3dvcmQpO1xuICAgICAgICBpZiAoaXNQYXNzd29yZFZhbGlkKSB7XG4gICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBhZ2VudERvYztcbiAgICAgICAgICBjb25zdCBhZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICBfaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGFnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgY29tcGFueUlkOiBhZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgfTtcbiAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShhZ2VudC5jb21wYW55SWQsIGFnZW50Lm5hbWUsICdMb2dpbicsIGBMb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5YCk7XG4gICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IGFnZW50IH07XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQuXCIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJEYXRhYmFzZSBjb25uZWN0aW9uIGVycm9yLlwiIH07XG4gICAgfVxufTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUFnZW50KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGFzc3dvcmRfdW51c2VkOiBzdHJpbmcsIHJvbGU6IEFnZW50Um9sZSwgY29tcGFueUlkOiBzdHJpbmcsIGNyZWF0ZWRCeTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG1lc3NhZ2U/OiBzdHJpbmc7IGFnZW50PzogQWdlbnQ7IH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBhZ2VudHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0QWdlbnRzQ29sbGVjdGlvbigpO1xuICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nQWdlbnQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBhZ2VudFRvSW5zZXJ0OiBPbWl0PEFnZW50LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICAgICAgcm9sZSxcbiAgICAgICAgICAgIGF2YXRhcixcbiAgICAgICAgICAgIHBob25lOiAnJywgXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5pbnNlcnRPbmUoYWdlbnRUb0luc2VydCBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IHJlc3VsdC5pbnNlcnRlZElkIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4uYWdlbnREYXRhIH0gPSBuZXdBZ2VudERvYztcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdBZ2VudDogQWdlbnQgPSB7XG4gICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICBfaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgaWQ6IG5ld0FnZW50RG9jLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBhd2FpdCBsb2dBY3Rpdml0eShjb21wYW55SWQsIGNyZWF0ZWRCeSwgJ0NyZWF0ZSBBZ2VudCcsIGBDcmVhdGVkIGFnZW50OiAke25hbWV9YCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgYWdlbnQ6IG5ld0FnZW50IH07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBhZ2VudC5cIiB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJDcmVhdGUgYWdlbnQgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZCB3aGlsZSBjcmVhdGluZyB0aGUgYWdlbnQuXCIgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVTaWduVXAobmFtZTogc3RyaW5nLCBlbWFpbDogc3RyaW5nLCBwYXNzd29yZF91bnVzZWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyBhZ2VudD86IEFnZW50OyB9PiB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBnZXREYigpO1xuICAgIGNvbnN0IHNlc3Npb24gPSBkYi5jbGllbnQuc3RhcnRTZXNzaW9uKCk7XG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IG5ld0FnZW50UmVzdWx0OiBBZ2VudCB8IHVuZGVmaW5lZDtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi53aXRoVHJhbnNhY3Rpb24oYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGFuaWVzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbXBhbmllc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgICAgIGNvbnN0IGFnZW50c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBZ2VudHNDb2xsZWN0aW9uKCk7XG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0FnZW50ID0gYXdhaXQgYWdlbnRzQ29sbGVjdGlvbi5maW5kT25lKHsgZW1haWw6IGVtYWlsLnRvTG93ZXJDYXNlKCkgfSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdBZ2VudCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFuIGFnZW50IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlSZXN1bHQgPSBhd2FpdCBjb21wYW5pZXNDb2xsZWN0aW9uLmluc2VydE9uZSh7XG4gICAgICAgICAgICAgICAgbmFtZTogYCR7bmFtZX0ncyBDb21wYW55YCxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9LCB7IHNlc3Npb24gfSk7XG5cbiAgICAgICAgICAgIGlmICghY29tcGFueVJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBjb21wYW55LlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhbnlJZCA9IGNvbXBhbnlSZXN1bHQuaW5zZXJ0ZWRJZDtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBoYXNoUGFzc3dvcmQocGFzc3dvcmRfdW51c2VkKTtcbiAgICAgICAgICAgIGNvbnN0IGF2YXRhciA9IGBodHRwczovL3BpY3N1bS5waG90b3Mvc2VlZC8ke25hbWUucmVwbGFjZSgvXFxzL2csICcnKX0vMTAwLzEwMGA7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGFnZW50VG9JbnNlcnQ6IE9taXQ8QWdlbnQsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICAgICAgICBhdmF0YXIsXG4gICAgICAgICAgICAgICAgcGhvbmU6ICcnLFxuICAgICAgICAgICAgICAgIGNvbXBhbnlJZDogY29tcGFueUlkLFxuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgY29uc3QgYWdlbnRSZXN1bHQgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmluc2VydE9uZShhZ2VudFRvSW5zZXJ0IGFzIGFueSwgeyBzZXNzaW9uIH0pO1xuXG4gICAgICAgICAgICAgaWYgKCFhZ2VudFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBhZG1pbiBhZ2VudC5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGF3YWl0IGxvZ0FjdGl2aXR5KGNvbXBhbnlJZCwgbmFtZSwgJ1NpZ24gVXAnLCBgQ3JlYXRlZCBuZXcgY29tcGFueSBhbmQgYWRtaW4gYWNjb3VudC5gKTtcblxuICAgICAgICAgICAgY29uc3QgbmV3QWdlbnREb2MgPSBhd2FpdCBhZ2VudHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBfaWQ6IGFnZW50UmVzdWx0Lmluc2VydGVkSWQgfSwgeyBzZXNzaW9uIH0pO1xuICAgICAgICAgICAgaWYgKG5ld0FnZW50RG9jKSB7XG4gICAgICAgICAgICAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLmFnZW50RGF0YSB9ID0gbmV3QWdlbnREb2M7XG4gICAgICAgICAgICAgICAgIG5ld0FnZW50UmVzdWx0ID0ge1xuICAgICAgICAgICAgICAgICAgICAuLi5hZ2VudERhdGEsXG4gICAgICAgICAgICAgICAgICAgIF9pZDogbmV3QWdlbnREb2MuX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgICAgIGlkOiBuZXdBZ2VudERvYy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBuZXdBZ2VudERvYy5jb21wYW55SWQ/LnRvU3RyaW5nKClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghbmV3QWdlbnRSZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkZhaWxlZCB0byByZXRyaWV2ZSB0aGUgY3JlYXRlZCBhZ2VudC5cIiB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBhZ2VudDogbmV3QWdlbnRSZXN1bHQgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTaWduIHVwIHRyYW5zYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICAgIC8vIEFib3J0IHRyYW5zYWN0aW9uIG9uIGVycm9yIGlmIGl0IHdhcyBzdGFydGVkXG4gICAgICAgIGlmIChzZXNzaW9uLmluVHJhbnNhY3Rpb24oKSkge1xuICAgICAgICAgICAgYXdhaXQgc2Vzc2lvbi5hYm9ydFRyYW5zYWN0aW9uKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkIGR1cmluZyBzaWduIHVwLlwiIH07XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgICAgYXdhaXQgc2Vzc2lvbi5lbmRTZXNzaW9uKCk7XG4gICAgfVxufVxuXG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBY3Rpdml0eUxvZ3MoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGl2aXR5TG9nW10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbG9nc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRBY3Rpdml0eUxvZ3NDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGxvZ3MgPSBhd2FpdCBsb2dzQ29sbGVjdGlvbi5maW5kKHsgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KS5zb3J0KHsgdGltZXN0YW1wOiAtMSB9KS5saW1pdCg1MCkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBsb2dzLm1hcChsb2cgPT4gKHtcbiAgICAgICAgICAgIC4uLmxvZyxcbiAgICAgICAgICAgIF9pZDogbG9nLl9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgaWQ6IGxvZy5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGNvbXBhbnlJZDogbG9nLmNvbXBhbnlJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBsb2cudGltZXN0YW1wLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgYWN0aXZpdHkgbG9nczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q29udGFjdHNCeUNvbXBhbnkoY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGlmICghY29tcGFueUlkIHx8ICFPYmplY3RJZC5pc1ZhbGlkKGNvbXBhbnlJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY29udGFjdHMgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZCh7IGNvbXBhbnlJZDogbmV3IE9iamVjdElkKGNvbXBhbnlJZCkgfSkudG9BcnJheSgpO1xuXG4gICAgICAgIHJldHVybiBjb250YWN0cy5tYXAoY29udGFjdCA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0IGFzIGFueTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgLi4ucmVzdCxcbiAgICAgICAgICAgICAgICBfaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIGlkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IGNvbXBhbnlJZD8udG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBub3RlczogY29udGFjdC5ub3RlcyB8fCBbXVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNvbnRhY3RzOlwiLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVDb250YWN0KG5hbWU6IHN0cmluZywgZW1haWw6IHN0cmluZywgcGhvbmU6IHN0cmluZywgY29tcGFueUlkOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgY29udGFjdD86IFVzZXIgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZXhpc3RpbmdDb250YWN0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmZpbmRPbmUoeyBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSwgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSB9KTtcbiAgICAgICAgaWYgKGV4aXN0aW5nQ29udGFjdCkge1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQSBjb250YWN0IHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cy5cIiB9O1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYXZhdGFyID0gYGh0dHBzOi8vcGljc3VtLnBob3Rvcy9zZWVkLyR7bmFtZS5yZXBsYWNlKC9cXHMvZywgJycpfS8xMDAvMTAwYDtcblxuICAgICAgICBjb25zdCBjb250YWN0VG9JbnNlcnQ6IE9taXQ8VXNlciwgJ2lkJyB8ICdfaWQnPiA9IHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBlbWFpbDogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIHBob25lLFxuICAgICAgICAgICAgYXZhdGFyLFxuICAgICAgICAgICAgY29tcGFueUlkOiBuZXcgT2JqZWN0SWQoY29tcGFueUlkKSxcbiAgICAgICAgICAgIG5vdGVzOiBbXSxcbiAgICAgICAgICAgIG9ubGluZTogZmFsc2UsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLmluc2VydE9uZShjb250YWN0VG9JbnNlcnQgYXMgYW55KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgY29uc3QgeyBfaWQsIGNvbXBhbnlJZDogbmV3Q29tcGFueUlkLCAuLi5yZXN0IH0gPSBjb250YWN0VG9JbnNlcnQgYXMgYW55O1xuICAgICAgICAgICAgY29uc3QgbmV3Q29udGFjdDogVXNlciA9IHtcbiAgICAgICAgICAgICAgICAuLi5yZXN0LFxuICAgICAgICAgICAgICAgIF9pZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogcmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLnRvU3RyaW5nKCksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgY29udGFjdDogbmV3Q29udGFjdCB9O1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiRmFpbGVkIHRvIGNyZWF0ZSBjb250YWN0LlwiIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiQ3JlYXRlIGNvbnRhY3QgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC5cIiB9O1xuICAgIH1cbn1cblxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYXNzaWduQWdlbnRUb0NvbnRhY3QoY29udGFjdElkOiBzdHJpbmcsIGFnZW50SWQ6IHN0cmluZyk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY29udGFjdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY29udGFjdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGFzc2lnbmVkQWdlbnRJZDogYWdlbnRJZCB9IH1cbiAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBhc3NpZ25pbmcgYWdlbnQ6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGROb3RlVG9Db250YWN0KGNvbnRhY3RJZDogc3RyaW5nLCBhZ2VudElkOiBzdHJpbmcsIGFnZW50TmFtZTogc3RyaW5nLCB0ZXh0OiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbm90ZT86IE5vdGUgfT4ge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRhY3RzQ29sbGVjdGlvbiA9IGF3YWl0IGdldENvbnRhY3RzQ29sbGVjdGlvbigpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbmV3Tm90ZTogTm90ZSA9IHtcbiAgICAgICAgICAgIGlkOiBuZXcgT2JqZWN0SWQoKS50b1N0cmluZygpLFxuICAgICAgICAgICAgYWdlbnRJZCxcbiAgICAgICAgICAgIGFnZW50TmFtZSxcbiAgICAgICAgICAgIHRleHQsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNvbnRhY3RzQ29sbGVjdGlvbi51cGRhdGVPbmUoXG4gICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSxcbiAgICAgICAgICAgIHsgJHB1c2g6IHsgbm90ZXM6IHsgJGVhY2g6IFtuZXdOb3RlXSwgJHBvc2l0aW9uOiAwIH0gfSB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVzdWx0Lm1vZGlmaWVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBub3RlOiBuZXdOb3RlIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWRkaW5nIG5vdGU6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXROb3Rlc0ZvckNvbnRhY3QoY29udGFjdElkOiBzdHJpbmcpOiBQcm9taXNlPE5vdGVbXT4ge1xuICAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbnRhY3RJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb250YWN0SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY29udGFjdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q29udGFjdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNvbnRhY3QgPSBhd2FpdCBjb250YWN0c0NvbGxlY3Rpb24uZmluZE9uZSh7IF9pZDogbmV3IE9iamVjdElkKGNvbnRhY3RJZCkgfSk7XG4gICAgICAgIHJldHVybiBjb250YWN0Py5ub3RlcyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgZmV0Y2hpbmcgbm90ZXM6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldENoYXRzQnlDb21wYW55KGNvbXBhbnlJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICB0cnkge1xuICAgICAgICBpZiAoIWNvbXBhbnlJZCB8fCAhT2JqZWN0SWQuaXNWYWxpZChjb21wYW55SWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gW107XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIGNvbnN0IGNoYXRzID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAtMSB9IH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJGxvb2t1cDoge1xuICAgICAgICAgICAgICAgICAgICBmcm9tOiAnY29udGFjdHMnLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbEZpZWxkOiAndXNlcklkJyxcbiAgICAgICAgICAgICAgICAgICAgZm9yZWlnbkZpZWxkOiAnX2lkJyxcbiAgICAgICAgICAgICAgICAgICAgYXM6ICd1c2VyJ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7ICR1bndpbmQ6ICckdXNlcicgfVxuICAgICAgICBdKS50b0FycmF5KCk7XG5cbiAgICAgICAgcmV0dXJuIGNoYXRzLm1hcChjaGF0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHsgX2lkLCBjb21wYW55SWQsIHVzZXJJZCwgLi4ucmVzdCB9ID0gY2hhdCBhcyBhbnk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgX2lkOiBfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICBpZDogX2lkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgY29tcGFueUlkOiBjb21wYW55SWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VySWQ6IHVzZXJJZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgd2lsbCBiZSBsYXp5LWxvYWRlZFxuICAgICAgICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgLi4uY2hhdC51c2VyLFxuICAgICAgICAgICAgICAgICAgICBfaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGNoYXQudXNlci5faWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICAgICAgY29tcGFueUlkOiBjaGF0LnVzZXIuY29tcGFueUlkLnRvU3RyaW5nKCksXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZldGNoaW5nIGNoYXRzIGJ5IGNvbXBhbnk6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldE1lc3NhZ2VzRm9yQ2hhdChjaGF0SWQ6IHN0cmluZyk6IFByb21pc2U8TWVzc2FnZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgICAgaWYgKCFjaGF0SWQgfHwgIU9iamVjdElkLmlzVmFsaWQoY2hhdElkKSkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzQ29sbGVjdGlvbiA9IGF3YWl0IGdldE1lc3NhZ2VzQ29sbGVjdGlvbigpO1xuICAgICAgICAvLyBBbHNvIGZldGNoIHNlbmRlciBkZXRhaWxzIGlmIGl0J3MgYSB1c2VyLCBub3QgYW4gYWdlbnQgKCdtZScpXG4gICAgICAgIGNvbnN0IG1lc3NhZ2VzID0gYXdhaXQgbWVzc2FnZXNDb2xsZWN0aW9uLmFnZ3JlZ2F0ZShbXG4gICAgICAgICAgICB7ICRtYXRjaDogeyBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpIH0gfSxcbiAgICAgICAgICAgIHsgJHNvcnQ6IHsgdGltZXN0YW1wOiAxIH0gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAkbG9va3VwOiB7XG4gICAgICAgICAgICAgICAgICAgIGZyb206ICdjb250YWN0cycsXG4gICAgICAgICAgICAgICAgICAgIGxvY2FsRmllbGQ6ICdzZW5kZXJJZCcsXG4gICAgICAgICAgICAgICAgICAgIGZvcmVpZ25GaWVsZDogJ19pZCcsXG4gICAgICAgICAgICAgICAgICAgIGFzOiAnc2VuZGVySW5mbydcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIF0pLnRvQXJyYXkoKTtcblxuICAgICAgICByZXR1cm4gbWVzc2FnZXMubWFwKG1zZyA9PiB7XG4gICAgICAgICAgICBjb25zdCB7IF9pZCwgY2hhdElkLCBzZW5kZXJJZCwgc2VuZGVySW5mbywgLi4ucmVzdCB9ID0gbXNnIGFzIGFueTtcbiAgICAgICAgICAgIGNvbnN0IHNlbmRlciA9IG1zZy5zZW5kZXIgPT09ICdtZScgPyAnbWUnIDogKHNlbmRlckluZm9bMF0gfHwgbnVsbCk7XG5cbiAgICAgICAgICAgIGlmIChzZW5kZXIgJiYgc2VuZGVyICE9PSAnbWUnKSB7XG4gICAgICAgICAgICAgICAgc2VuZGVyLmlkID0gc2VuZGVyLl9pZC50b1N0cmluZygpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIC4uLnJlc3QsXG4gICAgICAgICAgICAgICAgaWQ6IF9pZC50b1N0cmluZygpLFxuICAgICAgICAgICAgICAgIHNlbmRlcixcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBmZXRjaGluZyBtZXNzYWdlczpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1lc3NhZ2UoY2hhdElkOiBzdHJpbmcsIHRleHQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IG5ld01lc3NhZ2U/OiBNZXNzYWdlIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBtZXNzYWdlc0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRNZXNzYWdlc0NvbGxlY3Rpb24oKTtcbiAgICAgICAgY29uc3QgY2hhdHNDb2xsZWN0aW9uID0gYXdhaXQgZ2V0Q2hhdHNDb2xsZWN0aW9uKCk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgICAgICBjb25zdCBuZXdNZXNzYWdlOiBPbWl0PE1lc3NhZ2UsICdpZCcgfCAnX2lkJz4gPSB7XG4gICAgICAgICAgICBjaGF0SWQ6IG5ldyBPYmplY3RJZChjaGF0SWQpLFxuICAgICAgICAgICAgc2VuZGVyOiAnbWUnLCAvLyAnbWUnIGRlbm90ZXMgdGhlIGFnZW50XG4gICAgICAgICAgICBzZW5kZXJJZDogbmV3IE9iamVjdElkKGFnZW50SWQpLFxuICAgICAgICAgICAgdGV4dCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZXN0YW1wLnRvTG9jYWxlVGltZVN0cmluZyhbXSwgeyBob3VyOiAnMi1kaWdpdCcsIG1pbnV0ZTogJzItZGlnaXQnIH0pLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG1lc3NhZ2VzQ29sbGVjdGlvbi5pbnNlcnRPbmUobmV3TWVzc2FnZSBhcyBhbnkpO1xuXG4gICAgICAgIGlmIChyZXN1bHQuaW5zZXJ0ZWRJZCkge1xuICAgICAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgICAgICB7IF9pZDogbmV3IE9iamVjdElkKGNoYXRJZCkgfSxcbiAgICAgICAgICAgICAgICB7ICRzZXQ6IHsgbGFzdE1lc3NhZ2U6IHRleHQsIHRpbWVzdGFtcDogbmV3TWVzc2FnZS50aW1lc3RhbXAgfSB9XG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm4geyBcbiAgICAgICAgICAgICAgICBzdWNjZXNzOiB0cnVlLCBcbiAgICAgICAgICAgICAgICBuZXdNZXNzYWdlOiB7IC4uLm5ld01lc3NhZ2UsIGlkOiByZXN1bHQuaW5zZXJ0ZWRJZC50b1N0cmluZygpIH0gYXMgTWVzc2FnZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBzZW5kaW5nIG1lc3NhZ2U6XCIsIGVycm9yKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UgfTtcbiAgICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZXRDaGF0Ym90U3RhdHVzKGNoYXRJZDogc3RyaW5nLCBpc0FjdGl2ZTogYm9vbGVhbik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuIH0+IHtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICAgICAgYXdhaXQgY2hhdHNDb2xsZWN0aW9uLnVwZGF0ZU9uZShcbiAgICAgICAgICAgIHsgX2lkOiBuZXcgT2JqZWN0SWQoY2hhdElkKSB9LFxuICAgICAgICAgICAgeyAkc2V0OiB7IGlzQ2hhdGJvdEFjdGl2ZTogaXNBY3RpdmUgfSB9XG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc2V0dGluZyBjaGF0Ym90IHN0YXR1czpcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICAgIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN0YXJ0TmV3Q2hhdHModXNlcnM6IFVzZXJbXSwgbWVzc2FnZTogc3RyaW5nLCBjb21wYW55SWQ6IHN0cmluZywgYWdlbnRJZDogc3RyaW5nKTogUHJvbWlzZTxDaGF0W10+IHtcbiAgICBjb25zdCBjaGF0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDaGF0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBjb250YWN0c0NvbGxlY3Rpb24gPSBhd2FpdCBnZXRDb250YWN0c0NvbGxlY3Rpb24oKTtcbiAgICBjb25zdCBuZXdDaGF0czogQ2hhdFtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHVzZXIgb2YgdXNlcnMpIHtcbiAgICAgICAgbGV0IGNvbnRhY3QgPSB1c2VyO1xuICAgICAgICAvLyBJZiBpdCdzIGEgbmV3IGNvbnRhY3QgKGlkIHN0YXJ0cyB3aXRoICduZXctJyksIGNyZWF0ZSBpdCBmaXJzdC5cbiAgICAgICAgaWYgKHVzZXIuaWQuc3RhcnRzV2l0aCgnbmV3LScpKSB7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVDb250YWN0KHVzZXIubmFtZSwgdXNlci5lbWFpbCB8fCAnJywgdXNlci5waG9uZSB8fCAnJywgY29tcGFueUlkKTtcbiAgICAgICAgICAgIGlmIChjcmVhdGVSZXN1bHQuc3VjY2VzcyAmJiBjcmVhdGVSZXN1bHQuY29udGFjdCkge1xuICAgICAgICAgICAgICAgIGNvbnRhY3QgPSBjcmVhdGVSZXN1bHQuY29udGFjdDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBuZXcgY29udGFjdCBmb3IgJHt1c2VyLm5hbWV9YCk7XG4gICAgICAgICAgICAgICAgY29udGludWU7IC8vIFNraXAgdGhpcyBvbmVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICAgICAgY29uc3QgbmV3Q2hhdDogT21pdDxDaGF0LCAnaWQnIHwgJ19pZCc+ID0ge1xuICAgICAgICAgICAgdXNlcklkOiBuZXcgT2JqZWN0SWQoY29udGFjdC5pZCksXG4gICAgICAgICAgICBjb21wYW55SWQ6IG5ldyBPYmplY3RJZChjb21wYW55SWQpLFxuICAgICAgICAgICAgbGFzdE1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWVzdGFtcC50b0xvY2FsZVRpbWVTdHJpbmcoW10sIHsgaG91cjogJzItZGlnaXQnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICAgICAgICAgIHVucmVhZENvdW50OiAwLFxuICAgICAgICAgICAgcHJpb3JpdHk6ICdub3JtYWwnLFxuICAgICAgICAgICAgY2hhbm5lbDogJ1dlYmNoYXQnLCAvLyBEZWZhdWx0IGNoYW5uZWwgZm9yIG5ldyBjaGF0c1xuICAgICAgICAgICAgaXNDaGF0Ym90QWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjaGF0UmVzdWx0ID0gYXdhaXQgY2hhdHNDb2xsZWN0aW9uLmluc2VydE9uZShuZXdDaGF0IGFzIGFueSk7XG4gICAgICAgIFxuICAgICAgICBpZiAoY2hhdFJlc3VsdC5pbnNlcnRlZElkKSB7XG4gICAgICAgICAgICBhd2FpdCBzZW5kTWVzc2FnZShjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSwgbWVzc2FnZSwgYWdlbnRJZCk7XG4gICAgICAgICAgICBjb25zdCBjcmVhdGVkQ2hhdCA9IHtcbiAgICAgICAgICAgICAgICAuLi5uZXdDaGF0LFxuICAgICAgICAgICAgICAgIGlkOiBjaGF0UmVzdWx0Lmluc2VydGVkSWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgICAgICB1c2VyOiBjb250YWN0LFxuICAgICAgICAgICAgICAgIG1lc3NhZ2VzOiBbXSwgLy8gTWVzc2FnZXMgbG9hZGVkIHNlcGFyYXRlbHlcbiAgICAgICAgICAgIH0gYXMgQ2hhdDtcbiAgICAgICAgICAgIG5ld0NoYXRzLnB1c2goY3JlYXRlZENoYXQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdDaGF0cztcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoid1JBMFVzQiJ9
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
"[project]/src/app/page.tsx [app-client] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, k: __turbopack_refresh__, m: module } = __turbopack_context__;
{
__turbopack_context__.s({
    "default": (()=>Home)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/jsx-dev-runtime.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/dist/compiled/react/index.js [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$chat$2d$layout$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/dashboard/chat-layout.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$vertical$2d$nav$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/dashboard/vertical-nav.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$contacts$2d$view$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/dashboard/contacts-view.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$agents$2d$view$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/dashboard/agents-view.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$dashboard$2d$view$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/dashboard/dashboard-view.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$announcements$2d$view$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/dashboard/announcements-view.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$settings$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/dashboard/settings-dialog.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$campaigns$2d$view$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/dashboard/campaigns-view.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$my$2d$performance$2d$view$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/dashboard/my-performance-view.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$auth$2d$form$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/components/dashboard/auth-form.tsx [app-client] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$data$3a$ba6c97__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/src/app/data:ba6c97 [app-client] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$data$3a$a4abea__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__ = __turbopack_context__.i("[project]/src/app/data:a4abea [app-client] (ecmascript) <text/javascript>");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$use$2d$toast$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/hooks/use-toast.ts [app-client] (ecmascript)");
;
var _s = __turbopack_context__.k.signature();
"use client";
;
;
;
;
;
;
;
;
;
;
;
;
;
function Home({ params, searchParams }) {
    _s();
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["use"])(params);
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["use"])(searchParams);
    const [activeView, setActiveView] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])("Chat");
    const [isNavOpen, setIsNavOpen] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const [currentUser, setCurrentUser] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(null);
    const [isSettingsOpen, setIsSettingsOpen] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$index$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useState"])(false);
    const { toast } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$use$2d$toast$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useToast"])();
    const onLogin = async (email, password_unused)=>{
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$data$3a$ba6c97__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["handleLogin"])(email, password_unused);
        if (result.success && result.agent) {
            const agent = result.agent;
            setCurrentUser({
                id: agent.id,
                name: agent.name,
                avatar: agent.avatar,
                role: agent.role,
                email: agent.email,
                phone: agent.phone,
                companyId: agent.companyId
            });
            if (agent.role === 'admin') {
                setActiveView('Dashboard');
            } else {
                setActiveView('Chat');
            }
        }
        return {
            success: result.success,
            message: result.message
        };
    };
    const onSignUp = async (name, email, password_unused)=>{
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$app$2f$data$3a$a4abea__$5b$app$2d$client$5d$__$28$ecmascript$29$__$3c$text$2f$javascript$3e$__["handleSignUp"])(name, email, password_unused);
        if (result.success && result.agent) {
            toast({
                title: "Account Created!",
                description: "You can now sign in with your new credentials."
            });
            const agent = result.agent;
            setCurrentUser({
                id: agent.id,
                name: agent.name,
                avatar: agent.avatar,
                role: agent.role,
                email: agent.email,
                phone: agent.phone,
                companyId: agent.companyId
            });
            if (agent.role === 'admin') {
                setActiveView('Dashboard');
            } else {
                setActiveView('Chat');
            }
        }
        return result;
    };
    const handleLogout = ()=>{
        setCurrentUser(null);
        setActiveView('Chat');
    };
    const handleUpdateUser = (updatedUser)=>{
        setCurrentUser((prev)=>prev ? {
                ...prev,
                ...updatedUser
            } : null);
    };
    const renderView = ()=>{
        const props = {
            onMenuClick: ()=>setIsNavOpen(true),
            user: currentUser
        };
        switch(activeView){
            case "Chat":
                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$chat$2d$layout$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["ChatLayout"], {
                    user: currentUser,
                    onMenuClick: ()=>setIsNavOpen(true)
                }, void 0, false, {
                    fileName: "[project]/src/app/page.tsx",
                    lineNumber: 95,
                    columnNumber: 16
                }, this);
            case "Contacts":
                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$contacts$2d$view$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["ContactsView"], {
                    ...props
                }, void 0, false, {
                    fileName: "[project]/src/app/page.tsx",
                    lineNumber: 97,
                    columnNumber: 16
                }, this);
            case "Agents":
                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$agents$2d$view$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AgentsView"], {
                    ...props
                }, void 0, false, {
                    fileName: "[project]/src/app/page.tsx",
                    lineNumber: 99,
                    columnNumber: 16
                }, this);
            case "Dashboard":
                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$dashboard$2d$view$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["DashboardView"], {
                    ...props
                }, void 0, false, {
                    fileName: "[project]/src/app/page.tsx",
                    lineNumber: 101,
                    columnNumber: 16
                }, this);
            case "Announcements":
                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$announcements$2d$view$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AnnouncementsView"], {
                    ...props
                }, void 0, false, {
                    fileName: "[project]/src/app/page.tsx",
                    lineNumber: 103,
                    columnNumber: 16
                }, this);
            case "My Performance":
                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$my$2d$performance$2d$view$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["MyPerformanceView"], {
                    ...props
                }, void 0, false, {
                    fileName: "[project]/src/app/page.tsx",
                    lineNumber: 105,
                    columnNumber: 16
                }, this);
            case "Campaigns":
                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$campaigns$2d$view$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["CampaignsView"], {
                    ...props
                }, void 0, false, {
                    fileName: "[project]/src/app/page.tsx",
                    lineNumber: 107,
                    columnNumber: 17
                }, this);
            default:
                return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$chat$2d$layout$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["ChatLayout"], {
                    user: currentUser,
                    onMenuClick: ()=>setIsNavOpen(true)
                }, void 0, false, {
                    fileName: "[project]/src/app/page.tsx",
                    lineNumber: 109,
                    columnNumber: 16
                }, this);
        }
    };
    if (!currentUser) {
        return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("main", {
            className: "flex h-screen w-full items-center justify-center bg-background p-4 overflow-hidden auth-page-background",
            children: /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$auth$2d$form$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["AuthForm"], {
                onLogin: onLogin,
                onSignUp: onSignUp
            }, void 0, false, {
                fileName: "[project]/src/app/page.tsx",
                lineNumber: 116,
                columnNumber: 9
            }, this)
        }, void 0, false, {
            fileName: "[project]/src/app/page.tsx",
            lineNumber: 115,
            columnNumber: 7
        }, this);
    }
    return /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("main", {
        className: "flex h-screen bg-background",
        children: [
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$settings$2d$dialog$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["SettingsDialog"], {
                open: isSettingsOpen,
                onOpenChange: setIsSettingsOpen,
                user: currentUser,
                onUserUpdate: handleUpdateUser
            }, void 0, false, {
                fileName: "[project]/src/app/page.tsx",
                lineNumber: 123,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$components$2f$dashboard$2f$vertical$2d$nav$2e$tsx__$5b$app$2d$client$5d$__$28$ecmascript$29$__["VerticalNav"], {
                activeView: activeView,
                setActiveView: setActiveView,
                user: currentUser,
                onLogout: handleLogout,
                isOpen: isNavOpen,
                setIsOpen: setIsNavOpen,
                onSettingsClick: ()=>setIsSettingsOpen(true)
            }, void 0, false, {
                fileName: "[project]/src/app/page.tsx",
                lineNumber: 129,
                columnNumber: 7
            }, this),
            /*#__PURE__*/ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$dist$2f$compiled$2f$react$2f$jsx$2d$dev$2d$runtime$2e$js__$5b$app$2d$client$5d$__$28$ecmascript$29$__["jsxDEV"])("div", {
                className: "flex-1 md:pl-[70px] min-w-0",
                children: renderView()
            }, void 0, false, {
                fileName: "[project]/src/app/page.tsx",
                lineNumber: 138,
                columnNumber: 7
            }, this)
        ]
    }, void 0, true, {
        fileName: "[project]/src/app/page.tsx",
        lineNumber: 122,
        columnNumber: 5
    }, this);
}
_s(Home, "lRYzcIx1BjGS3fP25Hivr3lFfOw=", false, function() {
    return [
        __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$hooks$2f$use$2d$toast$2e$ts__$5b$app$2d$client$5d$__$28$ecmascript$29$__["useToast"]
    ];
});
_c = Home;
var _c;
__turbopack_context__.k.register(_c, "Home");
if (typeof globalThis.$RefreshHelpers$ === 'object' && globalThis.$RefreshHelpers !== null) {
    __turbopack_context__.k.registerExports(module, globalThis.$RefreshHelpers$);
}
}}),
}]);

//# sourceMappingURL=src_app_ea282454._.js.map